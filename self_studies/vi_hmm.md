# 変分ベイズで隠れマルコフモデルの統計モデリングをしたい！

例えば，emアルゴリズムではパラメータが与えられた後の各データ$\bold{X} = \{ x_1, ..., x_N \}$の分布に対して条件付き独立性が成り立っていた．
$$
p(\bold{X}|\theta) = \prod_{n=1}^{N}p(x_n|\theta) \tag{1}
$$

でも実際のデータは時系列である場合が多く，上のように単純なモデルでは現象をうまく説明できないこともある．  
隠れマルコフモデルでは，データに関して離散的な時系列の状態が存在することをモデルの過程に組み込むことで，例えば時系列データの変化点を検知したり，次の時刻に現れるデータ点を予測したりするなど，混合モデルでは実現の難しい応用に対しても解法を与えることができる．

## モデル
隠れマルコフモデルでは，クラスタ数$K$の混合モデルの潜在変数に時間依存を加えるだけで実現できる．混合モデルでは，潜在変数$\bold{S} = \{ \bold{s_1}, ..., \bold{s_N} \}$の発生過程に関して，式(1)のような独立性を仮定していた．  
今回のHMMでは，次のように隣り合った潜在変数$\bold{s_n}, \bold{s_{n-1}}$の間に依存性をもたえる．
$$
p(\bold{S}|\bold{\pi}, \bold{A}) = p(\bold{s_1}|\bold{\pi})\prod_{n=2}^{N}p(\bold{s_n}|\bold{s_{n-1}, \bold{A}}) \tag{2}
$$
ここで，Sは状態系列(state sequence)，Aは遷移確率行列(transition probability matrix)，$\pi$は初期確立(initial probability)を呼ぶ． 式(2)は1つ隣の状態のみに依存するから一次マルコフ連鎖とも呼ばれる．  
状態数を$K$と固定すると，パラメータを$\pi$としたカテゴリ分布によって初期状態$s_1$は決定される．
$$
p(s_1|\pi) = Cat(s_1|\pi) \tag{3}
$$
$\pi$の事前分布としては，カテゴリ分布の共役事前分布であるディリクレ分布を導入する．
$$
p(\pi) = Dir(\pi|\alpha) \tag{4}
$$
ここで，$\alpha$はディリクレ分布のハイパーパラメータである．  
一方，$A$は$K \times K$の行列として表現され，状態iから状態jに遷移する確率値を$A_{j, i}$によって表す．  
遷移確行列$A$を使って$s_{n-1}$から$s_n$に遷移するか確率は，以下の式で表される．
$$
\begin{aligned}
p(\bold{s_n}|\bold{s_{n-1}, A}) &= \prod_{i=1}^K Cat(\bold{s_n|A_{:, i}})^{\bold{s_{n-1, i}}} \\
&= \prod_{i=1}^K \prod_{j=1}^K A_{j, i} ^{s_{n, j}s_{n-1, i}}
\end{aligned}
$$